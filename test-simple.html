<!DOCTYPE html>
<html>
<head>
    <title>Test Dashboard API - Simple</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: #fff; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 8px; margin: 10px 0; }
        button:hover { background: #2563eb; }
        button:disabled { background: #666; cursor: not-allowed; }
        pre { background: #2a2a2a; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .loading { background: #f59e0b; }
        .success { background: #10b981; }
        .error { background: #ef4444; }
    </style>
</head>
<body>
    <h1>üöÄ Test Dashboard Generation</h1>
    <button id="testBtn" onclick="testAPI()">Generate Dashboard</button>
    <div id="status"></div>
    <pre id="result"></pre>

    <script>
        let startTime;
        
        async function testAPI() {
            const btn = document.getElementById('testBtn');
            const status = document.getElementById('status');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            status.className = 'status loading';
            status.innerHTML = '‚è≥ Sending request to Gemini... This may take 30-60 seconds...';
            result.textContent = '';
            
            startTime = Date.now();
            
            const requestBody = {
                schema: {
                    users: ['id', 'name', 'email'],
                    orders: ['id', 'userId', 'total', 'date']
                },
                components: ['BarChart', 'KPI Card']
            };

            console.log('Request:', requestBody);
            
            try {
                const response = await fetch('http://localhost:5034/api/dashboard/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                const data = await response.json();
                
                if (response.ok) {
                    status.className = 'status success';
                    status.innerHTML = `‚úÖ Success! (${elapsed}s)<br>Generated ${data.generatedCode.length} characters`;
                    result.textContent = data.generatedCode;
                } else {
                    status.className = 'status error';
                    status.innerHTML = `‚ùå Error ${response.status} (${elapsed}s)`;
                    result.textContent = JSON.stringify(data, null, 2);
                }
            } catch (error) {
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                status.className = 'status error';
                status.innerHTML = `‚ùå Network Error (${elapsed}s)`;
                result.textContent = error.message;
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
